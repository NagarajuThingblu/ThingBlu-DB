
<div class="content-section implementation GridDemo">
  <div class="ui-g">      
    <div class="ui-g-12">
      <p-panel header="{{ assignTaskResources.pageheading }}"  [toggleable]="true" [style]="{'margin-bottom':'20px'}">
        <form [formGroup]="assignTaskForm" (ngSubmit)="onSubmit(assignTaskForm.value)">
          <div class="ui-g ">    

              <div class="ui-g-12" *ngIf="prodDBRouteParams" >
                  <button 
                    pButton 
                    routerLink="../jointsproductiondashboard"
                    type="button" 
                    icon="fa fa-chevron-left" 
                    label="Back To Team Dashboard" 
                    style="float:right;"
                  >
                  </button>
              </div>
              <div class="ui-g-12" *ngIf="prodDBRouteParams" >
                    <!-- Grinding Details -->
                    <div class="ui-message ui-messages-info .ui-corner-all" 
                        *ngIf="prodDBRouteParams?.TaskTypeKey === 'GRINDING'">
                      <h5 class="first">Strain Details</h5>
                      <p-table [value]="prodDBRouteParamsArray" [responsive]="true">
                          <ng-template pTemplate="header">
                              <tr>
                                  <th>{{globalResource.strain}}</th>
                                  <th>{{assignTaskResources.weightNeeded}}</th>
                                  <th>{{assignTaskResources.availSourceMaterial}}</th>
                              </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-rowData>
                              <tr>
                                  <td>
                                      <span class="ui-column-title">{{globalResource.strain}}</span>
                                    {{rowData?.StrainName}}
                                  </td>                                  
                                  <td>
                                      <span class="ui-column-title">{{assignTaskResources.weightNeeded}}</span>
                                    {{rowData?.RawRequiredWt}}&nbsp;{{globalResource.gramUnit}}
                                  </td>
                                  <td>
                                      <span class="ui-column-title">{{assignTaskResources.availSourceMaterial}}</span>
                                    {{rowData?.RawAvlWt}}&nbsp;{{globalResource.gramUnit}}
                                  </td>
                              </tr>
                          </ng-template>
                      </p-table>
                    </div>
                    <!--End Grinding Details -->

                    <!-- Joints Creation Details -->
                    <div class="ui-message ui-messages-info .ui-corner-all" 
                      *ngIf="prodDBRouteParams?.TaskTypeKey === 'JOINTSCREATION'">
                      <h5 class="first">Strain Details</h5>
                      <p-table [value]="prodDBRouteParamsArray" [responsive]="true">
                          <ng-template pTemplate="header">
                              <tr>
                                  <th>{{globalResource.strain}}</th>
                                  <th>{{globalResource.size}}</th>
                                  <th>{{assignTaskResources.requiredQtyDot}}</th>
                                  <th>{{assignTaskResources.availMaterial}}</th>
                              </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-rowData>
                              <tr>
                                  <td>
                                      <span class="ui-column-title">{{globalResource.strain}}</span>
                                    {{rowData?.StrainName}}
                                  </td>
                                  <td>
                                      <span class="ui-column-title">{{globalResource.size}}</span>
                                    {{rowData?.UnitValue}}&nbsp;{{globalResource.gramUnit}}                               
                                  </td>
                                  <td>
                                      <span class="ui-column-title">{{assignTaskResources.requiredqty}}</span>
                                    <!-- {{rowData?.JointRequiredQty}}&nbsp;{{globalResource.units}} -->
                                    {{rowData?.JointRequiredQty }}&nbsp;{{rowData?.JointRequiredQty > 1 
                                      ? assignTaskResources.lblPreroll + 's' : assignTaskResources.lblPreroll }}
                                  </td>
                                  <td>
                                      <span class="ui-column-title">{{assignTaskResources.availMaterial}}</span>
                                    {{rowData?.GrindAvlWt}}&nbsp;{{globalResource.gramUnit}} 
                                  </td>
                              </tr>
                          </ng-template>
                      </p-table>
                    </div>
                    <!--End Joints Creation Details -->

                    <!-- Tamping Details -->
                    <div class="ui-message ui-messages-info .ui-corner-all" 
                      *ngIf="prodDBRouteParams?.TaskTypeKey === 'TAMPING'">
                      <h5 class="first">Strain Details</h5>
                      <p-table [value]="prodDBRouteParamsArray" [responsive]="true">
                          <ng-template pTemplate="header">
                              <tr>
                                  <th>{{globalResource.strain}}</th>
                                  <th>{{globalResource.size}}</th>
                                  <th>{{assignTaskResources.readyForTamping}}</th>
                              </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-rowData>
                              <tr>
                                  <td>
                                      <span class="ui-column-title">{{globalResource.strain}}</span>
                                    {{rowData?.StrainName}}
                                  </td>
                                  <td>
                                    <span class="ui-column-title">{{globalResource.size}}</span>
                                    {{rowData?.UnitValue}}&nbsp;{{globalResource.gramUnit}}
                                  </td>
                                  <td>
                                    <span class="ui-column-title">{{assignTaskResources.readyForTamping}}</span>
                                    <!-- {{rowData?.JointAvlQty}}&nbsp;{{globalResource.units}} -->
                                    {{rowData?.JointAvlQty }}&nbsp;{{rowData?.JointAvlQty > 1 
                                      ? assignTaskResources.lblPreroll + 's' : assignTaskResources.lblPreroll }}
                                  </td>
                              </tr>
                          </ng-template>
                      </p-table>
                    </div>
                    <!--End Tamping Details -->

                    <!-- Tubing Details -->
                    <div class="ui-message ui-messages-info .ui-corner-all" 
                        *ngIf="prodDBRouteParams?.TaskTypeKey === 'TUBING'">
                      <h5 class="first">Strain Details</h5>
                      <p-table [value]="prodDBRouteParamsArray" [responsive]="true">
                          <ng-template pTemplate="header">
                              <tr>
                                  <th>{{globalResource.strain}}</th>
                                  <th>{{globalResource.pkgsize}}</th>
                                  <th>{{assignTaskResources.readyForPackaging}}</th>
                              </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-rowData>
                              <tr>
                                  <td>
                                      <span class="ui-column-title">{{globalResource.strain}}</span>
                                    {{rowData?.StrainName}}
                                  </td>
                                  <td>
                                    <span class="ui-column-title">{{globalResource.pkgsize}}</span>
                                    {{rowData?.PkgTypeName}}&nbsp;-&nbsp;{{rowData?.ItemQty}}&nbsp;x&nbsp;
                                    {{rowData?.UnitValue}}&nbsp;{{globalResource.gramUnit}}
                                  </td>
                                  <td>
                                      <span class="ui-column-title">{{assignTaskResources.readyForPackaging}}</span>
                                    <!-- {{rowData?.TampAvlQty}}&nbsp;{{rowData?.PkgTypeName}} -->
                                    {{rowData?.TampAvlQty }}&nbsp;{{rowData?.TampAvlQty > 1 
                                      ? assignTaskResources.lblPreroll + 's' : assignTaskResources.lblPreroll }}
                                  </td>
                              </tr>
                          </ng-template>
                      </p-table>
                    </div>
                    <!--End Tubing Details -->

                     <!-- Tubing Lable Details -->
                     <div class="ui-message ui-messages-info .ui-corner-all" 
                      *ngIf="prodDBRouteParams?.TaskTypeKey === 'TUBELABELING'">
                      <h5 class="first">{{globalResource.strainDetails}}</h5>
                      <p-table [value]="prodDBRouteParamsArray">
                          <ng-template pTemplate="header">
                              <tr>
                                  <th>{{globalResource.strain}}</th>
                                  <th>{{globalResource.packageSize}} </th> 
                                  <th>{{globalResource.order}}</th>  
                                  <th>{{globalResource.readyforlabeling}}</th>                                
                              </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-rowData>
                              <tr>
                                  <td>{{rowData?.StrainName}}</td>
                                  <td>{{rowData?.PkgTypeName}} - {{rowData?.ItemQty}} x {{rowData?.UnitValue}} {{ globalResource.listgramunits }} </td>
                                  <td>{{rowData?.OrderRefId}}</td>
                                  <td>{{rowData?.TubeAvlQty}}</td>                                  
                              </tr>
                          </ng-template>
                      </p-table>
                    </div>
                    <!--End Tub Label Details -->
              </div>
 <!--Task Name -->
 <div class="ui-g-12 ui-md-6">
  <div class="paddingRL">
    <label for="taskname">
      {{ globalResource.taskCategory }}<span class="star">*</span>:
    </label>

    <p-dropdown          
      [filter] ="true"        
      [options]="taskcategories"                            
      placeholder="-- Select --"
      [(ngModel)]="assignTask.taskcategory"
      [autoWidth]="true"
      formControlName="taskCategory"
      (onChange)="taskcategorychange()"
      [readonly]="readonlyFlag"
      class="clsControl" 
      id="taskCategory"
      name="taskCategory">
    </p-dropdown>
    <!-- (onChange)="ChangeComponent()" -->
    <div
      class="ui-message ui-messages-error ui-corner-all" appErrorTooltip
      *ngIf="!assignTaskForm.controls['taskCategory'].valid&&assignTaskForm.controls['taskCategory'].dirty">
       
        {{ globalResource.tasknamerequired }}
    </div>
  </div>
</div>
<!--End Task Name -->   
            <!--Task Name -->
            <div class="ui-g-12 ui-md-6">
              <div class="paddingRL">
                <label for="taskname">
                  {{ globalResource.taskname }}<span class="star">*</span>:
                </label>
 
                <p-dropdown          
                  [filter] ="true"        
                  [options]="tasknames"                            
                  placeholder="-- Select --"
                  [(ngModel)]="assignTask.task"
                  [autoWidth]="true"
                  formControlName="taskname"
                  (onChange)="taskTypeChange()"
                  [readonly]="readonlyFlag"
                  class="clsControl" 
                  id="taskname"
                  name="taskname">
                </p-dropdown>
                <!-- (onChange)="ChangeComponent()" -->
                <div
                  class="ui-message ui-messages-error ui-corner-all" appErrorTooltip
                  *ngIf="!assignTaskForm.controls['taskname'].valid&&assignTaskForm.controls['taskname'].dirty">
                   
                    {{ globalResource.tasknamerequired }}
                </div>
              </div>
            </div>
            <!--End Task Name -->            

              <!-- Dynamic Component Contents Depends on whatever the task is selected -->
              <!-- <ng-template load-component style="width:100%;"></ng-template> -->
              <!-- <app-quarantine 
                *ngIf="assignTask.task=='1'" 
                style="width:100%;"                
                [TaskModel]="assignTask"
                [PageFlag]="page"
                [ParentFormGroup] = "assignTaskForm"
              >
              </app-quarantine> -->
              

              <app-trimming
                *ngIf="selectedTaskTypeName=='TRIMMING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Processing'" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"   
              >
              </app-trimming>

              <app-sifting
                *ngIf="selectedTaskTypeName=='SIFTING'&&this.isServiceCallComplete" 
                style="width:100%;"               
                [TaskModel]="assignTask"
                [PageFlag]="page"
                [ParentFormGroup] = "assignTaskForm"
               
              ></app-sifting>

              <!-- <app-bud-unlabelled-packaging
                *ngIf="assignTask.task=='4'" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              >
              </app-bud-unlabelled-packaging> -->

              <app-bud-packaging
                *ngIf="selectedTaskTypeName=='BUDPACKAGING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              >
              </app-bud-packaging>

              <app-grinding
                *ngIf="selectedTaskTypeName=='GRINDING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-grinding>

              <app-joints-creation
                *ngIf="selectedTaskTypeName=='JOINTSCREATION'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              >
                LOADER
              </app-joints-creation>
                          
              <app-tamping
                *ngIf="selectedTaskTypeName=='TAMPING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-tamping>
              
              <app-tubing
                *ngIf="selectedTaskTypeName=='TUBING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
                [TampQty]="tampQty"
              ></app-tubing>

              <app-oil-packaging
                *ngIf="selectedTaskTypeName=='OILPACKAGING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-oil-packaging>

              <app-custom-task
                *ngIf="(selectedTaskTypeName=='CUSTOMTASK' || selectedTaskTypeName=='INDEPENDENT' )&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-custom-task>

              <app-qa-check
                *ngIf="selectedTaskTypeName=='QACHECK'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-qa-check>

              <app-package-replacement
                *ngIf="selectedTaskTypeName=='REPACK'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-package-replacement>

              <app-brand-label-replacement
                *ngIf="selectedTaskTypeName=='REBRAND'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              ></app-brand-label-replacement>

              <app-tube-brand-label
                *ngIf="selectedTaskTypeName=='TUBELABELING'&&this.isServiceCallComplete" 
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
                [LabelQty]="labelQty"
              ></app-tube-brand-label>


              <app-planting
              *ngIf="selectedTaskTypeName=='PLANTING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'" 
              style="width:100%;"                 
              [TaskModel]="assignTask"       
              [PageFlag]="page"     
              [ParentFormGroup] = "assignTaskForm"   
            >
            </app-planting>
            <app-harvesting
              *ngIf="selectedTaskTypeName=='HARVESTING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'" 
              style="width:100%;"                 
              [TaskModel]="assignTask"       
              [PageFlag]="page"     
              [ParentFormGroup] = "assignTaskForm"   
            >
            </app-harvesting>
            <app-prebucking
              *ngIf="selectedTaskTypeName=='PREBUCKING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'" 
              style="width:100%;"   
              [TaskModel]="assignTask" 
              [PageFlag]="page"  
              [ParentFormGroup] = "assignTaskForm"          
            >
            </app-prebucking>

            <app-bucking
            *ngIf="selectedTaskTypeName=='BUCKING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'" 
            style="width:100%;"   
            [TaskModel]="assignTask" 
            [PageFlag]="page"  
            [ParentFormGroup] = "assignTaskForm"          
          >
          </app-bucking>

          <app-bud-packaging
                *ngIf="selectedTaskTypeName=='PACKAGING'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'"
                style="width:100%;"                 
                [TaskModel]="assignTask"       
                [PageFlag]="page"     
                [ParentFormGroup] = "assignTaskForm"
              >
          </app-bud-packaging>

          <app-growertrimming
            *ngIf="selectedTaskTypeName=='TRIM'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'
            
            " 
            style="width:100%;"   
            [TaskModel]="assignTask" 
            [PageFlag]="page"  
            [ParentFormGroup] = "assignTaskForm"          
          >
          </app-growertrimming>
          <!-- <app-d8-distillate
          *ngIf="selectedTaskTypeName=='D8DISTILLATE'&&this.isServiceCallComplete&&taskcategoriesMap.get(assignTaskForm.controls.taskCategory.value) === 'Growing'
          
          " 
          style="width:100%;"   
          [TaskModel]="assignTask" 
          [PageFlag]="page"  
          [ParentFormGroup] = "assignTaskForm"     
        >
        </app-d8-distillate> -->
        
              <!--End Dynamic Component Contents Depends on whatever the task is selected -->
              <div class="ui-g-12 ui-md-12 marginTop-15" style="text-align:right;padding-right: 20px;">
                <button pButton type="submit" label="Assign Task" ></button>
                <!-- [disabled]="!assignTaskForm.valid" -->
               
                <!-- comment clear button :: 10-april-2019 :: swapnil -->
                <!-- <button pButton 
                  type="button"  
                  label="Clear" 
                  class="ui-button-secondary" 
                  (click)="resetForm()" 
                ></button> -->

            </div>
          </div>
          <!-- <div style="text-align:center;margin-top:20px">
            Form Submitted
            <br> {{ diagnostic}}
          </div>          -->
        </form>
        <p-growl [(value)]="msgs" life='5000' ></p-growl>
      </p-panel>
    </div>
    <div class="ui-g-1">
    </div>
  </div>
</div>
<p-confirmDialog header="Confirmation" icon="fa fa-question-circle" width="425" class="clsConfirmBox" ></p-confirmDialog> 
